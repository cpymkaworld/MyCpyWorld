try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d56ecc3b-696b-4d93-818f-1b7df7f0e6cc",e._sentryDebugIdIdentifier="sentry-dbid-d56ecc3b-696b-4d93-818f-1b7df7f0e6cc")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[722],{1469:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return s},getImageProps:function(){return l}});let n=r(8229),a=r(8883),o=r(3063),c=n._(r(1193));function l(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:c.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let s=o.Image},2149:(e,t,r)=>{"use strict";r.d(t,{Am:()=>u,BN:()=>s,C2:()=>d,Dn:()=>a,GT:()=>o,L2:()=>c,Ub:()=>i,lQ:()=>l,v0:()=>n});let n="eaglercraft-launcher-settings",a="hideEaglerWASMAvailable",o="_eagler_dl_",c=".failedAt",l=["flameddogo99-eaglermobile.js","irv77-eaglercraft-mobile.js"],s={DB_NAME:"_eagler_loader_cache_v1",DB_VERSION:1,STORE_NAME:"file_cache"},i="google-translate-desktop-target",u="google-translate-mobile-target",d="google-translate-sidebar-target"},2361:e=>{e.exports={container:"LoaderUI_container__hMqjl",innerContainer:"LoaderUI_innerContainer__hlPtR",iconContainer:"LoaderUI_iconContainer__dLic0",icon:"LoaderUI_icon__q0ixJ",status:"LoaderUI_status__QbbWS",subStatus:"LoaderUI_subStatus__PZ_xm",progressBarOuter:"LoaderUI_progressBarOuter__OcmeD",progressBarVisible:"LoaderUI_progressBarVisible__xz_Ef",progressBarInner:"LoaderUI_progressBarInner__GRMsM",urlStatus:"LoaderUI_urlStatus__eAQ5j",buttonContainer:"LoaderUI_buttonContainer__vcVZF",actionButton:"LoaderUI_actionButton__mn_QJ"}},2644:(e,t,r)=>{Promise.resolve().then(r.bind(r,7955)),Promise.resolve().then(r.bind(r,7894)),Promise.resolve().then(r.bind(r,7472))},3554:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a.a});var n=r(9243),a=r.n(n),o={};for(let e in n)"default"!==e&&(o[e]=()=>n[e]);r.d(t,o)},3655:(e,t,r)=>{"use strict";r.d(t,{k:()=>o});var n=r(2115);let a={isLoading:!0,isMobile:!1,hasWasmGC:!1};function o(){let[e,t]=(0,n.useState)(a);return(0,n.useEffect)(()=>{let e=navigator.userAgent;t({isLoading:!1,isMobile:/Mobi|Android|iPhone|iPad|iPod/i.test(e),hasWasmGC:"undefined"!=typeof WebAssembly&&void 0!==WebAssembly.Suspending})},[]),e}},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let n=r(2115);function a(e,t){let r=(0,n.useRef)(null),a=(0,n.useRef)(null);return(0,n.useCallback)(n=>{if(null===n){let e=r.current;e&&(r.current=null,e());let t=a.current;t&&(a.current=null,t())}else e&&(r.current=o(e,n)),t&&(a.current=o(t,n))},[e,t])}function o(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6766:(e,t,r)=>{"use strict";r.d(t,{default:()=>a.a});var n=r(1469),a=r.n(n)},7389:e=>{e.exports={mainWrapperContainer:"PreRollAd_mainWrapperContainer__gQI18",pwVideoContainer:"PreRollAd_pwVideoContainer__gKuWO",websiteContentContainer:"PreRollAd_websiteContentContainer__MvCPc",adNotice:"PreRollAd_adNotice__MoM6h"}},7472:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var n=r(5155),a=r(2115),o=r(8631),c=r(7389),l=r.n(c);let s="eagler-last-ad-shown-timestamp-v2";function i(e){let{children:t}=e,[r,c]=(0,a.useState)(!1),[i,u]=(0,a.useState)(!1),[d,f]=(0,a.useState)("The game will start after the ad. This screen only appears once every few hours."),p=(0,a.useRef)(!0),m=(0,a.useRef)(null),h=(0,a.useRef)(null);return((0,a.useEffect)(()=>(p.current=!0,()=>{p.current=!1}),[]),(0,a.useEffect)(()=>{if("pre-roll"!==(0,o.i)())return void c(!0);try{let e=parseInt(localStorage.getItem(s)||"0",10);if(Date.now()<e+216e5)return void c(!0)}catch(e){}u(!0)},[]),(0,a.useEffect)(()=>{if(!i||r)return;let e=null;m.current=Date.now();let t=t=>{!h.current&&p.current&&(h.current=t,(t.includes("error")||t.includes("timeout")||t.includes("blocker")||t.includes("no ads returned"))&&f("Ad not available. The game will start shortly..."),e&&clearTimeout(e),setTimeout(()=>{if(p.current){c(!0);try{localStorage.setItem(s,Date.now().toString())}catch(e){}}},Math.max(0,3e3-(Date.now()-(m.current||Date.now())))))},n=()=>t("Ad blocker detected via event");window.addEventListener("rampBlocked",n);let a=()=>{if(!window.ramp||!window.ramp.que)return void t("RAMP API not ready on rampLoaded");e=setTimeout(()=>t("Process failsafe timeout"),15e3),window.ramp.que.push(()=>{if(!h.current&&p.current&&window.ramp){var e,r;window.ramp.onPlayerReady=()=>{if(!h.current&&p.current)if(window.Bolt&&"function"==typeof window.Bolt.on){var e,r;window.Bolt.on("precontent_ad_video","showHiddenContainer",()=>t("showHiddenContainer event (ad finished or no ads returned)")),window.Bolt.on("precontent_ad_video",window.Bolt.BOLT_AD_ERROR,()=>t("Ad error event")),null==(r=window.ramp)||null==(e=r.displayUnits)||e.call(r)}else t("Bolt object not found after onPlayerReady")},null==(e=(r=window.ramp).spaAddAds)||e.call(r,[{type:"precontent_ad_video"}])}})};return window.__isRampReady?a():window.addEventListener("rampLoaded",a,{once:!0}),()=>{e&&clearTimeout(e),window.removeEventListener("rampBlocked",n),window.removeEventListener("rampLoaded",a)}},[i,r]),r)?(0,n.jsx)(n.Fragment,{children:t}):i?(0,n.jsxs)("div",{id:"pw-ad-wrapper",className:l().mainWrapperContainer,children:[(0,n.jsx)("div",{id:"precontent_ad_video",className:l().pwVideoContainer}),(0,n.jsx)("div",{id:"my-content",className:l().websiteContentContainer}),(0,n.jsx)("p",{className:l().adNotice,children:d})]}):null}},7894:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var n=r(5155),a=r(2115),o=r(5695),c=r(2149),l=r(3655),s=r(9647),i=r.n(s);function u(e){let{gameVersion:t,onResponse:r}=e,[o,l]=(0,a.useState)(!1),s=e=>{o&&localStorage.setItem(c.Dn,"true"),r(e)};return(0,n.jsx)("div",{className:i().overlay,children:(0,n.jsx)("div",{className:i().panel,children:(0,n.jsxs)("div",{className:i().panelContent,children:[(0,n.jsxs)("h3",{children:["EaglercraftX",t?" ".concat(t):""," WebAssembly GC is supported on your browser, would you like to try it?"]}),(0,n.jsxs)("p",{children:["The new version of EaglercraftX",t?" ".concat(t):""," gets almost ",(0,n.jsx)("b",{children:"2x the FPS"}),", however it may crash if your device doesn't have a lot of memory"]}),(0,n.jsx)("p",{children:"Your existing singleplayer worlds will be available"}),(0,n.jsxs)("label",{htmlFor:"eaglerWASMAvailableDontShow",children:[(0,n.jsx)("input",{type:"checkbox",id:"eaglerWASMAvailableDontShow",className:i().checkbox,checked:o,onChange:e=>l(e.target.checked)}),"Do not show again"]}),(0,n.jsx)("p",{children:(0,n.jsx)("button",{onClick:()=>s(!0),className:i().button,children:"Switch to WebAssembly version"})}),(0,n.jsx)("p",{children:(0,n.jsx)("button",{onClick:()=>s(!1),className:i().button,children:"Keep using JavaScript version"})})]})})})}function d(e){let{children:t}=e,{showWasmPrompt:r,gameVersion:s,handleWasmPromptResponse:i}=function(){let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)(""),s=(0,o.useSearchParams)(),i=(0,o.useRouter)(),u=(0,o.usePathname)(),{isMobile:d,hasWasmGC:f,isLoading:p}=(0,l.k)(),m=(0,a.useRef)(!0),h=(0,a.useRef)(null);return(0,a.useEffect)(()=>(m.current=!0,()=>{m.current=!1,h.current&&h.current.parentNode&&(h.current.parentNode.removeChild(h.current),h.current=null)}),[]),(0,a.useEffect)(()=>{m.current&&u.includes("-wasm")&&!p&&(f||alert("DISCLAIMER: Your browser does not support the WebAssembly (WASM-GC) version of the game."))},[u,i,f,p]),(0,a.useEffect)(()=>{if(!m.current||p)return;let e="true"===localStorage.getItem(c.Dn),r=u.includes("-wasm"),a=["/mc/1.8.8/","/mc/1.12.2/"].includes(u.endsWith("/")?u:"".concat(u,"/"));if(f&&!e&&!r&&a){let e=u.match(/\/mc\/(\d+\.\d+(?:\.\d+)?)/),r=e?e[1]:"";m.current&&(n(r),t(!0))}},[u,f,p]),(0,a.useEffect)(()=>{if(!m.current||p)return;let e=s.get("userscript"),t=e?"/userscripts/".concat(e):null;if(t&&e&&c.lQ.includes(e)){if(!d&&confirm("Pointer lock is supported on this browser.\n\nWould you like to disable Touch Mode?")){let e=new URLSearchParams(s.toString());e.delete("userscript"),i.replace("".concat(u,"?").concat(e.toString()));return}if(!document.querySelector('script[src="'.concat(t,'"]'))&&m.current){alert("WARNING: These userscripts are 3rd-party creations and might crash your game!");let e=document.createElement("script");e.type="text/javascript",e.src=t,h.current=e,document.head.appendChild(e)}return()=>{if(h.current&&h.current.parentNode){try{h.current.parentNode.removeChild(h.current)}catch(e){}h.current=null}}}},[s,i,u,d,p]),(0,a.useEffect)(()=>{if(window.WebSocket.prototype.isViggWrapped)return;let e=window.WebSocket;window.WebSocket=class extends e{send(e){this.vigg&&Math.random()<((Date.now()-this.startTime)/12e4-.25)*.5||super.send(e)}constructor(e,t){super(e,t),this.vigg=-1!==e.toString().toLowerCase().indexOf(atob("bmlnaHRzaGFk")),this.startTime=0,this.vigg&&(this.startTime=Date.now(),setTimeout(()=>this.close(),1e5+Math.floor(2e4*Math.random())))}},window.WebSocket.prototype.isViggWrapped=!0},[]),{showWasmPrompt:e,gameVersion:r,handleWasmPromptResponse:e=>{if(!m.current)return;let r=document.getElementById("eaglerWASMAvailableDontShow");if((null==r?void 0:r.checked)&&localStorage.setItem(c.Dn,"true"),t(!1),e){let e=(u.endsWith("/")?"".concat(u.slice(0,-1),"-wasm/"):"".concat(u,"-wasm/"))+(s.toString()?"?".concat(s.toString()):"");window.location.href=e}}}}();return(0,n.jsxs)(n.Fragment,{children:[r&&(0,n.jsx)(u,{gameVersion:s,onResponse:i}),t]})}},7955:(e,t,r)=>{"use strict";r.d(t,{default:()=>R});var n=r(5155),a=r(3554),o=r(2115),c=r(2149);function l(){return new Promise((e,t)=>{let r=indexedDB.open(c.BN.DB_NAME,c.BN.DB_VERSION);r.onerror=()=>{var e;return t(Error("Error opening IndexedDB: "+((null==(e=r.error)?void 0:e.message)||"Unknown error")))},r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(c.BN.STORE_NAME)||t.createObjectStore(c.BN.STORE_NAME,{keyPath:"fileName"})}})}async function s(e){let t=null;try{return t=await l(),new Promise(r=>{let n=t.transaction(c.BN.STORE_NAME,"readonly"),a=n.objectStore(c.BN.STORE_NAME).get(e),o=()=>{t&&(t.close(),t=null)};n.oncomplete=()=>{o(),r(a.result||null)},n.onerror=()=>{o(),r(null)},n.onabort=()=>{o(),r(null)},setTimeout(()=>{t&&(o(),r(null))},1e4)})}catch(e){return t&&t.close(),null}}async function i(e){let t=null;try{return t=await l(),new Promise(r=>{let n=t.transaction(c.BN.STORE_NAME,"readwrite"),a=n.objectStore(c.BN.STORE_NAME).put(e),o=()=>{t&&(t.close(),t=null)};n.oncomplete=()=>{o(),r(!0)},n.onerror=()=>{o(),r(!1)},n.onabort=()=>{o(),r(!1)},a.onerror=()=>{},setTimeout(()=>{t&&(o(),r(!1))},1e4)})}catch(e){return t&&t.close(),!1}}async function u(e){if("undefined"==typeof DecompressionStream)throw Error("DecompressionStream API not supported in this browser!");try{let t=new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(t).arrayBuffer()}catch(e){throw Error("Decompression failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async function d(e,t){try{let r=new TextDecoder().decode(e),n=/servers\s*:\s*\[[^\]]*\]/,a=JSON.stringify(t);if(!n.test(r))return e;{let e=r.replace(n,"servers: ".concat(a));return new TextEncoder().encode(e).buffer}}catch(e){throw Error("Server injection failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}let f=e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"https://".concat(e,"/ipfs/").concat(t).concat(r?"/".concat(r):"")},p=e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"https://".concat(t,".ipfs.").concat(e).concat(r?"/".concat(r):"")},m=[f("ipfs.io"),p("dweb.link"),f("w3s.link"),p("nftstorage.link"),f("gateway.pinata.cloud")],h={status:"Initializing...",progress:0,scriptSrc:null,loadedBytes:0,totalBytes:0,isCachedAndReady:!1,cacheTimestamp:null,error:null,gatewayIndex:0,currentGatewayUrl:null};function y(e,t){switch(t.type){case"INITIALIZE":return{...h};case"SET_CACHED_CLIENT":return{...e,status:"Ready to launch from cache",isCachedAndReady:!0,cacheTimestamp:t.payload.timestamp,error:null};case"DOWNLOAD_ATTEMPT":return{...e,status:"Downloading... (attempt ".concat(t.payload.attempt,"/").concat(t.payload.total,")"),error:null,progress:0,loadedBytes:0,gatewayIndex:t.payload.index,currentGatewayUrl:t.payload.url};case"DOWNLOAD_PROGRESS":return{...e,loadedBytes:t.payload.loaded,totalBytes:Math.max(t.payload.total,e.totalBytes),progress:t.payload.total>0?t.payload.loaded/t.payload.total:0};case"DOWNLOAD_SUCCESS":return{...e,error:null,status:"Download completed"};case"DOWNLOAD_FAILURE":return{...e,error:t.payload.error,status:t.payload.isFinal?"Error: Download failed from all gateways.":t.payload.isRetrying?"Retrying... (".concat(t.payload.error,")"):e.status};case"PROCESS_START":return{...e,status:t.payload.message,progress:0,error:null};case"LAUNCH_CLIENT":return{...e,scriptSrc:t.payload.scriptSrc,status:"Client launched successfully"};case"SET_TOTAL_BYTES":return{...e,totalBytes:t.payload};case"CLEAR_ERROR":return{...e,error:null};default:return e}}let w=[{addr:"wss://mc.arch.lol",name:"\xa74Arc\xa7mh\xa7fMC Network"}];async function g(e,t,r,n,a){let o="".concat(e.cid,"/").concat(e.path||"").replace(/\/$/,"");try{let l=await s(e.file);if(!a.current)return!1;if(l&&l.clientVersionUID===o)try{return n.current=await d(l.clientPayload,w),a.current&&t({type:"SET_CACHED_CLIENT",payload:{timestamp:l.clientCachedAt}}),!0}catch(e){}if(function(e){if(void 0===window.localStorage)return!1;let t="".concat(c.GT).concat(e).concat(c.L2);try{let e=window.localStorage.getItem(t);if(e){let r=parseInt(e,10);if(isNaN(r))return window.localStorage.removeItem(t),!1;if(Date.now()-r<216e5)return!0;window.localStorage.removeItem(t)}}catch(e){try{window.localStorage.removeItem(t)}catch(e){}}return!1}(o)&&l&&confirm("Failed to update the client recently. Would you like to launch the outdated version from cache?")&&a.current)try{let e=await d(l.clientPayload,w);return r(e),!0}catch(e){return r(l.clientPayload),!0}return!1}catch(e){return a.current&&t({type:"DOWNLOAD_FAILURE",payload:{error:"Cache check failed, proceeding with download",isFinal:!1,isRetrying:!1}}),!1}}async function _(e,t,r,n,a){try{let o,c="".concat(t.cid,"/").concat(t.path||"").replace(/\/$/,"");if(!a.current)return;r({type:"PROCESS_START",payload:{message:"Decompressing..."}});let l=t.gzip?await u(e):e;if(!a.current)return;try{o=await d(l,w)}catch(e){o=l}if(!a.current)return;r({type:"PROCESS_START",payload:{message:"Caching client..."}});try{await i({fileName:t.file,clientVersionUID:c,clientCachedAt:Date.now(),clientPayload:o})}catch(e){}if(!a.current)return;n(o)}catch(t){let e=t instanceof Error?t.message:"Client processing failed.";a.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:e,isFinal:!0,isRetrying:!1}})}}var b=r(6766),S=r(2361),v=r.n(S);function E(e){let t,r,a,{clientName:c,status:l,progress:s,loadedBytes:i,totalBytes:u,isCachedAndReady:d,cacheTimestamp:f,error:p,currentGatewayUrl:m,isLastGateway:h,onLaunchFromCache:y,onRetry:w,onSkip:g}=e,_=(0,o.useRef)(null),S=(0,o.useRef)(!1);(0,o.useEffect)(()=>(_.current&&(clearTimeout(_.current),_.current=null),d&&!S.current?(S.current=!0,_.current=setTimeout(()=>{y(),_.current=null},1500)):d||(S.current=!1),()=>{_.current&&(clearTimeout(_.current),_.current=null)}),[d,y]);let E=f?"Last fetched: ".concat(function(e){let t=Math.floor((Date.now()-e)/1e3);if(t<10)return"a few seconds ago";if(t<60)return"".concat(t," seconds ago");let r=Math.floor(t/60);if(r<60)return"".concat(r," minute").concat(r>1?"s":""," ago");let n=Math.floor(r/60);if(n<24)return"".concat(n," hour").concat(n>1?"s":""," ago");let a=Math.floor(n/24);return"".concat(a," day").concat(a>1?"s":""," ago")}(f)):"Last fetched: now";if(p)t="Error: Could not download client!",r="Download was aborted."===p?"Download skipped!":"Client download failed!",a=m||"Please try again later";else if(d)t="Loading ".concat(c),r="Launching...",a=E;else{t="Loading ".concat(c);let e="Update: ".concat(Math.round(.001*i)," / ").concat(Math.round(.001*u)," kB");r=u>0?e:l,a=m||""}let R=!d&&s>=0;return(0,n.jsx)("div",{className:v().container,children:(0,n.jsxs)("div",{className:v().innerContainer,children:[(0,n.jsx)("div",{className:v().iconContainer,children:(0,n.jsx)(b.default,{className:v().icon,src:"/img/loading-icon.webp",alt:"Loading icon",width:200,height:200})}),(0,n.jsx)("h2",{className:v().status,children:t}),(0,n.jsx)("h3",{className:v().subStatus,children:r}),(0,n.jsx)("div",{className:"".concat(v().progressBarOuter," ").concat(R?v().progressBarVisible:""),children:(0,n.jsx)("div",{className:v().progressBarInner,style:{width:"".concat(Math.round(100*s),"%")}})}),(0,n.jsx)("h5",{className:v().urlStatus,children:a}),(0,n.jsx)("div",{className:v().buttonContainer,children:p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:w,className:v().actionButton,children:"Retry"}),(0,n.jsx)("button",{onClick:g,className:v().actionButton,disabled:h,children:"Skip Gateway"})]}):(0,n.jsx)("button",{onClick:g,className:v().actionButton,disabled:!m||h,children:"Skip Download"})})]})})}function R(e){let{config:t}=e,{scriptSrc:r,launchFromCache:l,retryDownload:s,skipGateway:i,isLastGateway:u,...d}=function(e){let[t,r]=(0,o.useReducer)(y,h),n=(0,o.useRef)(null),a=(0,o.useRef)(null),l=(0,o.useRef)(!1),s=(0,o.useRef)(!0),i=(0,o.useRef)(!1),u=(0,o.useRef)(new Set),d=(0,o.useRef)(!1),f=(0,o.useRef)(null),p=(0,o.useMemo)(()=>[...m].sort(()=>Math.random()-.5),[]);(0,o.useEffect)(()=>{s.current=!0;let e=u.current;return()=>{s.current=!1,d.current=!1,a.current&&(a.current.abort(),a.current=null),e.forEach(e=>{try{URL.revokeObjectURL(e)}catch(e){}}),e.clear()}},[]);let w=(0,o.useCallback)(e=>{if(!l.current&&s.current&&!d.current){d.current=!0,l.current=!0;try{let t=new Blob([e],{type:"text/javascript;charset=utf-8"}),n=URL.createObjectURL(t);u.current.add(n),r({type:"LAUNCH_CLIENT",payload:{scriptSrc:n}})}catch(e){d.current=!1,l.current=!1,s.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"Failed to prepare client for launch",isFinal:!0,isRetrying:!1}})}}},[]),b=(0,o.useCallback)(()=>{n.current&&s.current&&!l.current&&!d.current&&(r({type:"PROCESS_START",payload:{message:"Launching..."}}),w(n.current))},[w]),S=(0,o.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e||!s.current||i.current||d.current||l.current)return;i.current=!0,a.current&&(a.current.abort(),a.current=null);let n="".concat(e.cid,"/").concat(e.path||"").replace(/\/$/,"");for(let o=t;o<p.length;o++){if(!s.current||l.current){i.current=!1;return}let t=p[o](e.cid,e.path);r({type:"DOWNLOAD_ATTEMPT",payload:{url:t,index:o,attempt:o+1,total:p.length}});try{let{promise:n,xhr:o}=function(e,t,r){let n=new XMLHttpRequest;return{promise:new Promise((a,o)=>{n.open("GET",e),n.responseType="arraybuffer",n.timeout=18e4,n.addEventListener("progress",e=>{let n=t>0?t:e.total;r(e.loaded,n)}),n.addEventListener("load",()=>{n.status>=200&&n.status<300?a(n.response):o(Error("Download failed: HTTP Status ".concat(n.status)))}),n.addEventListener("error",()=>o(Error("Download failed: A network error occurred."))),n.addEventListener("abort",()=>o(Error("Download was aborted."))),n.addEventListener("timeout",()=>o(Error("Download timed out."))),n.send()}),xhr:n}}(t,e.dlSize,(e,t)=>{s.current&&!l.current&&r({type:"DOWNLOAD_PROGRESS",payload:{loaded:e,total:t}})});a.current=o;let c=await n;if(a.current=null,!s.current||l.current){i.current=!1;return}r({type:"DOWNLOAD_SUCCESS"}),await _(c,e,r,w,s),i.current=!1;return}catch(u){if(a.current=null,!s.current||l.current){i.current=!1;return}let e=u instanceof Error?u.message:String(u);if("Download was aborted."===e)continue;let t=o===p.length-1;if(r({type:"DOWNLOAD_FAILURE",payload:{error:e,isFinal:t,isRetrying:!t}}),t){if(void 0!==window.localStorage)try{let e="".concat(c.GT).concat(n).concat(c.L2);window.localStorage.setItem(e,Date.now().toString())}catch(e){}i.current=!1}}}i.current=!1},[e,w,p]);(0,o.useEffect)(()=>{(async()=>{var t,o;if(!e||!s.current){s.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"No game configuration provided.",isFinal:!0,isRetrying:!1}});return}if(((null==(t=f.current)?void 0:t.cid)!==e.cid||(null==(o=f.current)?void 0:o.path)!==e.path)&&(l.current=!1,i.current=!1,d.current=!1,n.current=null,f.current=e,a.current&&(a.current.abort(),a.current=null),u.current.forEach(e=>{try{URL.revokeObjectURL(e)}catch(e){}}),u.current.clear(),r({type:"INITIALIZE"})),s.current&&!l.current){if(r({type:"SET_TOTAL_BYTES",payload:e.dlSize}),!window.indexedDB){s.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"IndexedDB is not supported in your browser.",isFinal:!0,isRetrying:!1}});return}try{await g(e,r,w,n,s)||!s.current||l.current||d.current||S()}catch(e){s.current&&!l.current&&(r({type:"DOWNLOAD_FAILURE",payload:{error:e instanceof Error?e.message:"Cache check failed",isFinal:!1,isRetrying:!1}}),d.current||S())}}})()},[e,w,S]),(0,o.useEffect)(()=>{let e=t.scriptSrc,r=u.current;return()=>{if(e&&r.has(e)){try{URL.revokeObjectURL(e)}catch(e){}r.delete(e)}}},[t.scriptSrc]);let v=(0,o.useCallback)(()=>{!s.current||i.current||d.current||l.current||(l.current=!1,d.current=!1,r({type:"CLEAR_ERROR"}),S(0))},[S]),E=(0,o.useCallback)(()=>{s.current&&!l.current&&(!t.error||i.current||d.current?a.current&&i.current&&a.current.abort():(r({type:"CLEAR_ERROR"}),S(t.gatewayIndex+1)))},[S,t.gatewayIndex,t.error]),R=t.gatewayIndex>=p.length-1;return{...t,isLastGateway:R,launchFromCache:b,retryDownload:v,skipGateway:E}}(t);return r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"game_frame",style:{width:"100vw",height:"100vh"}}),(0,n.jsx)(a.default,{src:r,strategy:"afterInteractive"})]}):(0,n.jsx)(E,{clientName:(null==t?void 0:t.name)||"Eaglercraft",onLaunchFromCache:l,onRetry:s,onSkip:i,isLastGateway:u,...d})}},8631:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});function n(){return"in-game"}},9647:e=>{e.exports={overlay:"WasmPrompt_overlay__S8Uso",panel:"WasmPrompt_panel__DitwJ",panelContent:"WasmPrompt_panelContent__nZeSx",checkbox:"WasmPrompt_checkbox__ZrjmG",button:"WasmPrompt_button__9Z_Aa"}}},e=>{e.O(0,[352,63,850,441,691,358],()=>e(e.s=2644)),_N_E=e.O()}]);